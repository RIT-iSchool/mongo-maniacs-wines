<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ wine.title }}</title>
  <style>
    /* --- Light Theme Styles --- */
    :root { --brand:#900028; --brand-dark:#5d001e; --bg:#f4f4f9; --card:#ffffff; --line:#e6e6ee; --muted:#666; }
    body { font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; margin:0; padding:20px; background:var(--bg); color:#333; line-height:1.6; }
    .container { max-width: 980px; margin: 0 auto; }
    a{ color:var(--brand); text-decoration:none; } a:hover{ text-decoration:underline; }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,.04); padding:18px; margin-bottom:18px; }
    h1,h3{ color:var(--brand-dark); margin:12px 0; border-bottom: 1px solid var(--line); padding-bottom: 8px;}
    .grid{ display:grid; gap:18px; grid-template-columns: 220px 1fr; }
    .flag img{ width:100%; height:auto; object-fit:contain; border-radius:8px; border:1px solid var(--line); }
    .pill-row{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 6px; }
    .pill{ font-size:.85rem; padding:6px 10px; border-radius:999px; background:#f1f1f7; border:1px solid var(--line); }
    .badges{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px; }
    .badge{ font-size:.85rem; padding:4px 8px; border-radius:999px; background:#eef9f1; border:1px solid var(--line); }
    .muted{ color:var(--muted); }
    label{ font-weight:600; display:block; margin-bottom:6px; }
    input[type="text"], textarea{ width:100%; padding:10px; border:1px solid #ccc; border-radius:8px; font-size:1rem; box-sizing:border-box; }
    button{ background:var(--brand); color:#fff; border:none; border-radius:8px; padding:10px 16px; font-weight:700; cursor:pointer; }
    button:hover{ background:var(--brand-dark); }
    /* Comment list specific styles */
    .comments-list { list-style:none; padding:0; margin:0 0 12px 0; }
    .comments-list li { border:1px solid var(--line); border-radius:8px; padding:12px; margin-bottom:10px; background: #fafafa; }
    .comment-meta { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 5px;}
    .comment-author { font-weight: bold; }
    .comment-date { font-size: 0.85rem; color: var(--muted); }


    @media (max-width: 760px){ .grid{ grid-template-columns: 1fr; } .flag img{ width: 150px; height:auto; } }
  </style>
</head>
<body>
  <div class="container">


    <a href="{{ url_for('index') }}">&larr; Back to search</a>


    <div class="card">
      <h1>{{ wine.title }}</h1>
      <div class="grid">
        <div class="flag">
          {% if wine.country_image %}
            <img src="{{ url_for('get_image', id=wine.country_image) }}" alt="{{ wine.country }} flag">
          {% else %}
            <img src="{{ url_for('static', filename='default.png') }}" alt="No flag">
          {% endif %}
        </div>


        <div>
          <div class="pill-row">
            {% if wine.country %}<span class="pill">{{ wine.country }}</span>{% endif %}
            {% if wine.province %}<span class="pill">{{ wine.province }}</span>{% endif %}
            {% if wine.variety %}<span class="pill">{{ wine.variety }}</span>{% endif %}
            {% if wine.winery %}<span class="pill">{{ wine.winery }}</span>{% endif %}
          </div>


          <div class="badges">
            {% if wine.points %}<span class="badge">Points: {{ wine.points }}</span>{% endif %}
            {% if wine.price %}<span class="badge">Price: ${{ wine.price }}</span>{% endif %}
          </div>


          {% if wine.description %}
            <p class="muted">{{ wine.description }}</p>
          {% endif %}
        </div>
      </div>
    </div>


    <!-- Comments -->
    <div class="card">
      <h3>Comments</h3>
      <ul class="comments-list">
        {% if wine.comments and wine.comments|length > 0 %}
          {# Sort comments by createdAt date, newest first #}
          {% for c in wine.comments | sort(attribute='createdAt', reverse=True) %}
            <li>
              <div class="comment-meta">
                  <strong class="comment-author">{{ c.author or 'anonymous' }}</strong>
                  {# Use strftime for consistent date formatting #}
                  {% if c.createdAt %}
                    <span class="comment-date">{{ c.createdAt.strftime('%Y-%m-%d %H:%M') }} UTC</span>
                  {% endif %}
              </div>
              <div>{{ c.text }}</div>
            </li>
          {% endfor %}
        {% else %}
          <li class="muted" style="border: none; background: none; padding-left: 0;">No comments yet.</li>
        {% endif %}
      </ul>


      <form action="{{ url_for('add_comment', id=wine._id) }}" method="POST">
        <label for="author">Your Name</label>
        <input type="text" id="author" name="author" placeholder="anonymous" />


        <label for="text" style="margin-top:10px;">Add a comment</label>
        <textarea id="text" name="text" rows="4" required></textarea>


        <div style="margin-top:10px;">
          <button type="submit">Submit Comment</button>
        </div>
      </form>
    </div>


  </div>
</body>
</html>

